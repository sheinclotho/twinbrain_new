# TwinBrain V5 配置文件
# ===================

# 数据配置
data:
  # 数据根目录 - 修改为你的数据路径
  root_dir: "F:/twinbrain_v3/test_file3"
  
  # 要处理的模态
  modalities: ["eeg", "fmri"]
  
  # 任务名称 (可选, 留空则处理所有)
  task: null
  
  # 最大被试数 (用于测试, null表示处理所有)
  max_subjects: 0
  
  # Atlas配置
  atlas:
    name: "schaefer200"
    file: "atlases/Schaefer2018_200Parcels_7Networks_order_FSLMNI152_2mm.nii.gz"
    label_file: "atlases/schaefer200_mask_ready.json"

# 模型配置
model:
  # 模型类型: "graph_native" 或 "v5_optimized"
  type: "v5_optimized"
  
  # 隐藏层维度
  hidden_channels: 128
  
  # 编码器层数
  num_encoder_layers: 4
  
  # 解码器层数
  num_decoder_layers: 3
  
  # 是否启用预测
  use_prediction: true
  
  # 预测步数
  prediction_steps: 10
  
  # Dropout率
  dropout: 0.1

# 训练配置
training:
  # 训练轮数
  num_epochs: 100
  
  # 批次大小
  batch_size: 1
  
  # 学习率
  learning_rate: 0.0001
  
  # 权重衰减
  weight_decay: 0.00001
  
  # Use adaptive loss balancing
  use_adaptive_loss: true
  
  # Use EEG enhancement
  use_eeg_enhancement: true
  
  # Use gradient checkpointing (saves memory)
  use_gradient_checkpointing: false
  
  # Gradient clipping
  max_grad_norm: 1.0
  
  # 验证频率 (每N个epoch)
  val_frequency: 5
  
  # 保存检查点频率
  save_frequency: 10
  
  # 早停patience
  early_stopping_patience: 20

# V5优化配置
v5_optimization:
  # 自适应损失平衡
  adaptive_loss:
    alpha: 1.5
    learning_rate: 0.025
    update_frequency: 10
    warmup_epochs: 5
    modality_energy_ratios:
      eeg: 0.02
      fmri: 1.0
  
  # EEG通道增强
  eeg_enhancement:
    enable_monitoring: true
    enable_dropout: true
    enable_attention: true
    enable_regularization: true
    dropout_rate: 0.1
    attention_hidden_dim: 64
    entropy_weight: 0.01
    diversity_weight: 0.01
    activity_weight: 0.01
  
  # 高级预测
  advanced_prediction:
    use_hierarchical: true
    use_transformer: true
    use_uncertainty: true
    num_scales: 3
    num_windows: 3
    sampling_strategy: "uniform"

# 图配置
graph:
  # fMRI连接性阈值
  threshold_fmri: 0.3
  
  # EEG连接性阈值
  threshold_eeg: 0.2
  
  # fMRI K近邻 (小世界网络)
  k_nearest_fmri: 20
  
  # EEG K近邻 (更局部的连接)
  k_nearest_eeg: 10
  
  # 是否添加自环
  add_self_loops: true
  
  # 是否无向图
  make_undirected: true
  
  # 跨模态边距离阈值 (mm)
  cross_modal_distance_threshold: 30.0

# 输出配置
output:
  # 输出目录
  output_dir: "outputs"
  
  # 实验名称
  experiment_name: "twinbrain_v5"
  
  # 是否保存图结构
  save_graphs: true
  
  # 是否保存预测结果
  save_predictions: true
  
  # 日志级别
  log_level: "INFO"

# 设备配置
device:
  # 使用的设备: "cuda", "cpu", 或 "cuda:0"
  type: "cuda"
  
  # GPU内存配置 (8GB, 12GB, 16GB)
  gpu_memory: "8GB"
  
  # 是否使用混合精度
  use_amp: True
